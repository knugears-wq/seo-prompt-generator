import streamlit as st

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í˜ì´ì§€ ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(
    page_title="SEO í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°",
    page_icon="ğŸ”",
    layout="wide"
)

st.title("ğŸ” SEO ë¸”ë¡œê·¸ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°")
st.caption("ì›ë¬¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ Claudeì— ë°”ë¡œ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆëŠ” ì™„ì„±ëœ SEO í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„± í•¨ìˆ˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def generate_prompt(source_content: str, target_audience: str, target_keyword: str, tone: str, ref_style: str, result_count: int) -> str:

    # ì°¸ê³  ìŠ¤íƒ€ì¼ ì„¹ì…˜ ìƒì„±
    if ref_style.strip():
        ref_style_block = f"\n[ì°¸ê³  ìŠ¤íƒ€ì¼]\n{ref_style}"
    else:
        ref_style_block = ""

    # ê²°ê³¼ë¬¼ ê°œìˆ˜ ì§€ì‹œë¬¸
    if result_count == 1:
        count_instruction = "ìœ„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ SEO ìµœì í™” ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì¤˜."
    else:
        count_instruction = f"ìœ„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ SEO ìµœì í™” ë¸”ë¡œê·¸ ê¸€ì„ {result_count}ê°œ ì‘ì„±í•´ì¤˜. ê° ë²„ì „ì€ ì œëª©ê³¼ êµ¬ì¡°ë¥¼ ë‹¤ë¥´ê²Œ ì‘ì„±í•˜ê³  [ë²„ì „ 1], [ë²„ì „ 2]{', [ë²„ì „ 3]' if result_count == 3 else ''} í˜•íƒœë¡œ êµ¬ë¶„í•´ì¤˜."

    prompt = f"""<role>
ë‹¹ì‹ ì€ Google SEO ì „ë¬¸ê°€ì´ì ì›Œë“œí”„ë ˆìŠ¤ ì½˜í…ì¸  ì „ëµê°€ì…ë‹ˆë‹¤.
ê²€ìƒ‰ì—”ì§„ ì•Œê³ ë¦¬ì¦˜(Google E-E-A-T, Core Web Vitals)ì— ì •í†µí•˜ë©°,
í‚¤ì›Œë“œ ìµœì í™”ì™€ ë…ì ê²½í—˜ì„ ë™ì‹œì— ê³ ë ¤í•œ ì½˜í…ì¸ ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.
</role>

<task>
ë‚´ê°€ ì œê³µí•˜ëŠ” ì›ë¬¸ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ:
1. SEO ê´€ì ì—ì„œ ê¸€ì˜ êµ¬ì¡°ë¥¼ ì¬í¸ì„±í•˜ê³ 
2. í•µì‹¬ í‚¤ì›Œë“œ ë° LSI í‚¤ì›Œë“œë¥¼ ì „ëµì ìœ¼ë¡œ ë°°ì¹˜í•˜ë©°
3. ì›Œë“œí”„ë ˆìŠ¤ì— ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ í˜•íƒœë¡œ ìµœì¢… ì½˜í…ì¸ ë¥¼ ì‘ì„±í•´ì¤˜.
</task>

<input_required>
[ì›ë¬¸ ë‚´ìš©]
{source_content}

[íƒ€ê²Ÿ ë…ì]
{target_audience}

[ëª©í‘œ í‚¤ì›Œë“œ]
{target_keyword}

[í†¤ì•¤ë§¤ë„ˆ]
{tone}{ref_style_block}
</input_required>

<seo_rules>
ë°˜ë“œì‹œ ì•„ë˜ SEO ê·œì¹™ì„ ì ìš©í•´ì¤˜:

[í‚¤ì›Œë“œ ì „ëµ]
- ë©”ì¸ í‚¤ì›Œë“œ: ì œëª©(H1), ì²« ë‹¨ë½ 100ì ì´ë‚´, ë©”íƒ€ ë””ìŠ¤í¬ë¦½ì…˜ì— ë°˜ë“œì‹œ í¬í•¨
- ì„œë¸Œ í‚¤ì›Œë“œ(LSI): H2, H3 ì†Œì œëª©ì— ìì—°ìŠ¤ëŸ½ê²Œ ë¶„ì‚° ë°°ì¹˜
- í‚¤ì›Œë“œ ë°€ë„: ì „ì²´ ê¸€ì˜ 1~2% ìœ ì§€ (ê³¼ë„í•œ ë°˜ë³µ ê¸ˆì§€)
- ë¡±í…Œì¼ í‚¤ì›Œë“œ: ì†Œì œëª© ë˜ëŠ” FAQ ì„¹ì…˜ì— í™œìš©

[ê¸€ êµ¬ì¡°]
- ì „ì²´ ë¶„ëŸ‰: ìµœì†Œ 1,200ì ì´ìƒ (SEO ê¶Œì¥)
- H1(1ê°œ) â†’ H2(3~5ê°œ) â†’ H3(í•„ìš”ì‹œ) ê³„ì¸µ êµ¬ì¡° ìœ ì§€
- ë„ì…ë¶€: ë…ìì˜ Pain Pointë¥¼ ì§šê³  ê¸€ì˜ ê°€ì¹˜ë¥¼ ëª…í™•íˆ ì œì‹œ
- ë³¸ë¬¸: ì •ë³´ì˜ ë…¼ë¦¬ì  íë¦„ ìœ ì§€, í•µì‹¬ ë‚´ìš©ì€ ì•ì— ë°°ì¹˜
- ë§ˆë¬´ë¦¬: í•µì‹¬ ìš”ì•½ + CTA(Call to Action) í¬í•¨

[ì›Œë“œí”„ë ˆìŠ¤ ìµœì í™”]
- ë©”íƒ€ ì œëª©(Title Tag): 60ì ì´ë‚´, ë©”ì¸ í‚¤ì›Œë“œ í¬í•¨
- ë©”íƒ€ ë””ìŠ¤í¬ë¦½ì…˜: 150~160ì, í‚¤ì›Œë“œ + í´ë¦­ ìœ ë„ ë¬¸êµ¬ í¬í•¨
- URL Slug ì¶”ì²œ: ì˜ë¬¸ ì†Œë¬¸ì, í•˜ì´í”ˆ(-) êµ¬ë¶„, í‚¤ì›Œë“œ í¬í•¨
- ì´ë¯¸ì§€ ALT í…ìŠ¤íŠ¸: í‚¤ì›Œë“œ í¬í•¨ ë¬¸êµ¬ ì¶”ì²œ
- ë‚´ë¶€ ë§í¬ ìœ„ì¹˜: [ë‚´ë¶€ë§í¬: ê´€ë ¨ ê¸€ ì œëª©] í˜•íƒœë¡œ í‘œì‹œ
- ì¶”ì²œ íƒœê·¸/ì¹´í…Œê³ ë¦¬ ì œì•ˆ í¬í•¨
</seo_rules>

<output_format>
ìµœì¢… ê²°ê³¼ë¬¼ì€ ì•„ë˜ ìˆœì„œë¡œ ì¶œë ¥í•´ì¤˜:
---
[SEO ë¶„ì„ ìš”ì•½]
- ë©”ì¸ í‚¤ì›Œë“œ:
- ì„œë¸Œ í‚¤ì›Œë“œ ëª©ë¡:
- ì˜ˆìƒ ê²€ìƒ‰ ì˜ë„(User Intent):

[ì›Œë“œí”„ë ˆìŠ¤ ì„¤ì •ê°’]
- ë©”íƒ€ ì œëª©:
- ë©”íƒ€ ë””ìŠ¤í¬ë¦½ì…˜:
- URL Slug:
- ì¶”ì²œ ì¹´í…Œê³ ë¦¬/íƒœê·¸:
- ì´ë¯¸ì§€ ALT í…ìŠ¤íŠ¸ ì˜ˆì‹œ:

[ìµœì¢… ë¸”ë¡œê·¸ ë³¸ë¬¸]
(H1 / H2 / H3 ê³„ì¸µ êµ¬ì¡°ë¡œ ì‘ì„±ëœ ì™„ì„± ë³¸ë¬¸)

[ë‚´ë¶€ ë§í¬ ì œì•ˆ]

[FAQ ì„¹ì…˜]
---
</output_format>

<constraints>
- í‚¤ì›Œë“œë¥¼ ì–µì§€ë¡œ ë¼ì›Œ ë„£ì§€ ë§ê³  ë¬¸ë§¥ìƒ ìì—°ìŠ¤ëŸ½ê²Œ ì‚½ì…í•  ê²ƒ
- ë…ìê°€ ëê¹Œì§€ ì½ê³  ì‹¶ì€ íë¦„ì„ ìœ ì§€í•  ê²ƒ
- í‘œì ˆ ì—†ì´ ë‚´ê°€ ì œê³µí•œ ì›ë¬¸ì„ ì¬êµ¬ì„±í•˜ëŠ” ê²ƒì— ì§‘ì¤‘í•  ê²ƒ
- ë¶ˆí•„ìš”í•œ ë¯¸ì‚¬ì—¬êµ¬, ì¤‘ë³µ í‘œí˜„ ì œê±°
</constraints>

{count_instruction}

---

[ì¸ë„¤ì¼ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸]
ìœ„ ë¸”ë¡œê·¸ ë‚´ìš©ì˜ ë¶„ìœ„ê¸°ì— ë§ëŠ” Flora AIìš© ì¸ë„¤ì¼ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ë¥¼ ì˜ë¬¸ìœ¼ë¡œ ì‘ì„±í•´ì¤˜. (1280x720, í´ë¦°/ë¯¸ë‹ˆë©€ + ì¸í¬ê·¸ë˜í”½ ìŠ¤íƒ€ì¼)"""

    return prompt


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë©”ì¸ UI
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
col_left, col_right = st.columns([1, 1], gap="large")

with col_left:
    st.subheader("ğŸ“ ì›ë¬¸ ì •ë³´ ì…ë ¥")

    source_content = st.text_area(
        "ì›ë¬¸ ë‚´ìš© *",
        height=200,
        placeholder="ì—¬ê¸°ì— ë³´ìœ í•˜ê³  ìˆëŠ” ì •ë³´ë‚˜ ì´ˆì•ˆì„ ì…ë ¥í•˜ì„¸ìš”."
    )

    target_audience = st.text_area(
        "íƒ€ê²Ÿ ë…ì *",
        height=80,
        placeholder="ì˜ˆ: 30ëŒ€ ì§ì¥ì¸, íˆ¬ì ì´ˆë³´ì, ì°½ì—… ì¤€ë¹„ì ë“±"
    )

    target_keyword = st.text_area(
        "ëª©í‘œ í‚¤ì›Œë“œ",
        height=80,
        placeholder='ì˜ˆ: "ì¬í…Œí¬ ë°©ë²•", "ETF íˆ¬ì ì´ˆë³´" â€” ì—†ìœ¼ë©´ ì¶”ì²œí•´ì¤˜ ë¼ê³  ì…ë ¥'
    )

    tone = st.text_area(
        "í†¤ì•¤ë§¤ë„ˆ *",
        height=80,
        placeholder="ì˜ˆ: ì¹œê·¼í•˜ê³  ì‰¬ìš´ ì„¤ëª…ì²´, ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ” ì–´ì¡° ë“±"
    )

    st.markdown("**ì°¸ê³  ìŠ¤íƒ€ì¼** (ì„ íƒì‚¬í•­)")
    ref_style_text = st.text_area(
        "í…ìŠ¤íŠ¸ë¡œ ì§ì ‘ ì…ë ¥",
        height=80,
        placeholder="ì˜ˆ: ë§ë‘ë§ë‘í•œ ì–´íˆ¬, ì§§ì€ ë¬¸ë‹¨, ì´ëª¨ì§€ ì‚¬ìš© ë“±",
        label_visibility="collapsed"
    )
    ref_style_url = st.text_input(
        "ì°¸ê³ í•  ë¸”ë¡œê·¸ URL ì…ë ¥",
        placeholder="ì˜ˆ: https://yourblog.com/example-post"
    )

    # ì°¸ê³  ìŠ¤íƒ€ì¼ í•©ì¹˜ê¸°
    ref_style_parts = []
    if ref_style_text.strip():
        ref_style_parts.append(f"ìŠ¤íƒ€ì¼ ì„¤ëª…: {ref_style_text.strip()}")
    if ref_style_url.strip():
        ref_style_parts.append(f"ì°¸ê³  URL: {ref_style_url.strip()}")
    ref_style = "\n".join(ref_style_parts)

    st.markdown("**ìµœì¢… ê²°ê³¼ë¬¼ ê°œìˆ˜**")
    result_count = st.radio(
        "ê²°ê³¼ë¬¼ ê°œìˆ˜",
        options=[1, 2, 3],
        format_func=lambda x: f"{x}ê°œ",
        horizontal=True,
        label_visibility="collapsed"
    )

    generate_btn = st.button("ğŸš€ í”„ë¡¬í”„íŠ¸ ìƒì„±", type="primary", use_container_width=True)


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ê²°ê³¼ ì¶œë ¥
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with col_right:
    st.subheader("ğŸ“„ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸")

    if generate_btn:
        if not source_content.strip():
            st.error("âŒ ì›ë¬¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        elif not target_audience.strip():
            st.error("âŒ íƒ€ê²Ÿ ë…ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        elif not tone.strip():
            st.error("âŒ í†¤ì•¤ë§¤ë„ˆë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        else:
            keyword_value = target_keyword.strip() if target_keyword.strip() else "ì¶”ì²œí•´ì¤˜"
            result = generate_prompt(source_content, target_audience, keyword_value, tone, ref_style, result_count)

            st.success("âœ… í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ! ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ Claudeì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.")

            # ë³µì‚¬ìš© í…ìŠ¤íŠ¸ ë°•ìŠ¤
            st.text_area(
                "ë³µì‚¬ìš© í”„ë¡¬í”„íŠ¸",
                value=result,
                height=500,
                label_visibility="collapsed"
            )

            st.divider()

            # ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
            dl_col1, dl_col2 = st.columns(2)
            with dl_col1:
                st.download_button(
                    label="ğŸ’¾ MD íŒŒì¼ ì €ì¥",
                    data=result,
                    file_name="seo_prompt.md",
                    mime="text/markdown",
                    use_container_width=True
                )
            with dl_col2:
                st.download_button(
                    label="ğŸ’¾ TXT íŒŒì¼ ì €ì¥",
                    data=result,
                    file_name="seo_prompt.txt",
                    mime="text/plain",
                    use_container_width=True
                )
    else:
        st.info("ğŸ‘ˆ ì™¼ìª½ì— ì›ë¬¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  [í”„ë¡¬í”„íŠ¸ ìƒì„±] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.")
